{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<h2 class="m-3">
{% if category == 1 %}
Нужен бокс? Отлично! Выбирайте.
{% elif category == 2 %}
Хотите сдать на хранение? Отлично! Выбирайте.
{% else %}
Уточните ваш выбор
{% endif %}
</h2>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h5>Пожалуйста, уточните данные:</h5>
            <form action="." method="post">
                {{ order_unit_form.as_p }}
                {% if not user.is_authenticated %}
                    <h5>Для формирования заказа заполните, пожалуйста, анкету:</h5>
                    <p></p>
                    {{ registration_form.as_p }}
                {% endif %}
                {% csrf_token %}
                <p><input type="submit" value="Продолжить"></p>
            </form>
        </div>
    </div>

<div class="row">
<h2>Стоимость аренды</h2>
<h3 id="rent_price">{{ initial_price }}</h3>
</div>

{% endblock %}

{% block jsfiles %}
<script>
    $("#id_unit").change(function () {
      var unit_id = $(this).val();
      var quantity = $("#id_quantity").val();
      var duration = $("#id_rent_duration").val();
      var warehouse_id = $("#id_warehouse").val();

      $.ajax({
        url: '{% url "get_unit_price" %}',
        data: {
          'unit_id': unit_id,
          'quantity': quantity,
          'duration': duration,
          'warehouse_id': warehouse_id,
        },
        dataType: 'json',
        success: function (data) {
          document.getElementById("rent_price").innerHTML = data.price;
        }
      });

    });


    $("#id_quantity").change(function () {
      var quantity = $(this).val();
      var unit_id = $("#id_unit").val();
      var duration = $("#id_rent_duration").val();
      var warehouse_id = $("#id_warehouse").val();

      $.ajax({
        url: '{% url "get_unit_price" %}',
        data: {
          'unit_id': unit_id,
          'quantity': quantity,
          'duration': duration,
          'warehouse_id': warehouse_id,
        },
        dataType: 'json',
        success: function (data) {
          document.getElementById("rent_price").innerHTML = data.price;
        }
      });

    });

    $("#id_rent_duration").change(function () {
      var duration = $(this).val();
      var unit_id = $("#id_unit").val();
      var quantity = $("#id_quantity").val();
      var warehouse_id = $("#id_warehouse").val();

      $.ajax({
        url: '{% url "get_unit_price" %}',
        data: {
          'unit_id': unit_id,
          'quantity': quantity,
          'duration': duration,
          'warehouse_id': warehouse_id,
        },
        dataType: 'json',
        success: function (data) {
          document.getElementById("rent_price").innerHTML = data.price;
        }
      });

    });    

    $("#id_warehouse").change(function () {
      var warehouse_id = $(this).val();
      var unit_id = $("#id_unit").val();
      var quantity = $("#id_quantity").val();
      var duration = $("#id_rent_duration").val();

      $.ajax({
        url: '{% url "get_unit_price" %}',
        data: {
          'unit_id': unit_id,
          'quantity': quantity,
          'duration': duration,
          'warehouse_id': warehouse_id,
        },
        dataType: 'json',
        success: function (data) {
          document.getElementById("rent_price").innerHTML = data.price;
        }
      });

    });    



  </script>
{% endblock %}  